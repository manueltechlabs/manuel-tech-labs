---
/**
  Home page
    This file manages the main list of posts for the website, handling the home page and any subsequent archive pages using Astro's dynamic routing and pagination features.
    In Astro, files in the src/pages/ directory use file-based routing. The square brackets [...] denote a "rest parameter" in a dynamic route. 
  */
import type { GetStaticPaths } from 'astro';
import { getCollection } from 'astro:content';
import Button from '@/components/base/button.astro';
import HeadingBlock from '@/components/layout/heading-block.astro';
import Pagination from '@/components/layout/pagination.astro';
import WhatIDoSection from '@/components/sections/what-i-do-section.astro';
import FeaturedPosts from '@/components/post/featured-posts.astro';
import FeaturedProjects from '@/components/project/featured-projects.astro';
import Posts from '@/components/post/posts.astro';

import { siteConfig } from '@/app/config/site';
import BaseLayout from '@/app/layouts/base-layout.astro';

const allPosts = await getCollection('posts', ({ data }) => !data.isDraft);

const sortedPosts = allPosts.sort((a, b) => {
  return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
});

const numberOfPages = Math.ceil(sortedPosts.length / siteConfig.postsPerPage);


export const getStaticPaths = (async ({ paginate }) => {
  // data
  const allPosts = await getCollection('posts', ({ data }) => !data.isDraft);
  return paginate(
    allPosts.sort((a, b) => {
      return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
    }),
    {
      pageSize: siteConfig.postsPerPage,
    }
  );
}) satisfies GetStaticPaths;

const { page } = Astro.props;

const title =
  page.currentPage === 1 ? siteConfig.title : siteConfig.title + ' ' + 'Page ' + page.currentPage;

---

<BaseLayout title={title}>
  <main class='main'>
    {
      page.currentPage === 1 ?
        <HeadingBlock
          title="Blog Posts"
          descriptionItems={["Navigate though my Blog Posts",]}
        />
      : <h1 class='page-heading'>
          {"Blog Posts"} Page {page.currentPage}
        </h1>
    }
    {
      <Posts posts={page.data} />
    }
    {
      numberOfPages > 1 && (
        <Pagination
          currentPage={page.currentPage}
          numPages={numberOfPages}
          slug='/'
        />
      )
    }
  </main>
</BaseLayout>
